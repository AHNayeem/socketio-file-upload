/* Socket IO File Upload Client-Side Library
 *   Copyright (C) 2013 Shane Carr
 *   Released under the X11 License
 * For more information, visit: https://github.com/vote539/socketio-file-upload
 */

window.SocketIOFileUpload=function(m){var h=this;if(!window.File||!window.FileReader)throw Error("Socket.IO File Upload: Browser Not Supported");var f={},n=[],p=[];h.fileInputElementId="siofu_input";h.useText=!1;h.serializedOctets=!1;var k=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!1,!1);for(var j in b)b.hasOwnProperty(j)&&(c[j]=b[j]);return h.dispatchEvent(c)},q=function(a){if(k("start",{file:a})){var b=new FileReader,c=0,j=n.length,f=h.useText,d;n.push(a);b.addEventListener("progress",
function(a){if(!(a.loaded<a.total)){var d;if(f)d=b.result.slice(c,a.loaded);else try{var l=new Uint8Array(b.result,c,a.loaded);if(h.serializedOctets)d=l;else{var g,k=l.buffer.byteLength,e="";for(g=0;g<k;g+=3)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l[g]>>2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(l[g]&3)<<4|l[g+1]>>4],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(l[g+1]&15)<<2|l[g+2]>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l[g+
2]&63];2===k%3?e=e.substring(0,e.length-1)+"=":1===k%3&&(e=e.substring(0,e.length-2)+"==");d=e}}catch(n){m.emit("siofu_done",{id:j,interrupt:!0});return}m.emit("siofu_progress",{id:j,start:c,end:a.loaded,content:d,base64:h.serializedOctets?!1:!0});c=a.loaded}});b.addEventListener("load",function(){m.emit("siofu_done",{id:j});k("load",{file:a,reader:b,name:d})});m.emit("siofu_start",{name:a.name,mtime:a.lastModifiedDate,encoding:f?"text":"octet",id:j});p.push(f?function(c){b.readAsText(a);d=c}:function(c){b.readAsArrayBuffer(a);
d=c})}},d=function(a){var b=a.target.files||a.dataTransfer.files;a.preventDefault();if(0<b.length&&k("choose",{files:b}))for(a=0;a<b.length;a++)q(b[a])};this.listenOnInput=function(a){a.files&&a.addEventListener("change",d,!1)};this.listenOnDrop=function(a){a.addEventListener("dragover",function(a){a.preventDefault()},!1);a.addEventListener("drop",d)};this.prompt=function(){var a;a=document.getElementById(h.fileInputElementId);a||(a=document.createElement("input"),a.setAttribute("type","file"),a.setAttribute("id",
h.fileInputElementId),a.style.display="none",document.body.appendChild(a));a.addEventListener("change",d,!1);var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(b)};this.addEventListener=function(a,b){f[a]||(f[a]=[]);f[a].push(b)};this.removeEventListener=function(a,b){if(!f[a])return!1;for(var c=0;c<f[a].length;c++)if(f[a][c]===b)return f[a].splice(c,1),!0;return!1};this.dispatchEvent=function(a){var b=f[a.type];if(!b)return!0;
for(var c=!0,d=0;d<b.length;d++)!1===b[d](a)&&(c=!1);return c};m.on("siofu_ready",function(a){p[a.id](a.name)});m.on("siofu_complete",function(a){k("complete",{file:n[a.id],success:a.success})})};